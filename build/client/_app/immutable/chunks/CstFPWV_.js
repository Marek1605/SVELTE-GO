import{w as d}from"./DcdZDViH.js";const g=!0,f=g,k={isLoggedIn:!1,token:null,vendor:null,shop:null,loading:!0};function m(){const{subscribe:u,set:a,update:i}=d(k);{const e=localStorage.getItem("vendor_token");e?(i(t=>({...t,token:e,loading:!0})),l(e)):i(t=>({...t,loading:!1}))}async function l(e){const t="http://pc4kcc0ko0k0k08gk840cos0.46.224.7.54.sslip.io/api/v1";try{const o=await fetch(`${t}/auth/me`,{headers:{Authorization:`Bearer ${e}`}});if(o.ok){const s=await o.json();if(s.success){a({isLoggedIn:!0,token:e,vendor:s.data.vendor,shop:s.data.shop,loading:!1});return}}c()}catch{c()}}async function p(e,t,o=!1){const s="http://pc4kcc0ko0k0k08gk840cos0.46.224.7.54.sslip.io/api/v1";try{const n=await(await fetch(`${s}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,remember_me:o})})).json();return n.success?(f&&(localStorage.setItem("vendor_token",n.data.token),o&&localStorage.setItem("vendor_token_expires",String(Date.now()+(o?30:1)*24*60*60*1e3))),a({isLoggedIn:!0,token:n.data.token,vendor:n.data.vendor,shop:n.data.shop,loading:!1}),{success:!0}):{success:!1,error:n.error}}catch{return{success:!1,error:"Chyba pripojenia"}}}async function h(e){const t="http://pc4kcc0ko0k0k08gk840cos0.46.224.7.54.sslip.io/api/v1",o=`${e.first_name} ${e.last_name}`.trim();try{const r=await(await fetch(`${t}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password,name:o,company_name:e.shop_name,contact_person:o,shop_name:e.shop_name,shop_url:e.shop_url})})).json();return r.success?{success:!0}:{success:!1,error:r.error}}catch{return{success:!1,error:"Chyba pripojenia"}}}function c(){{const e=localStorage.getItem("vendor_token");e&&fetch("http://pc4kcc0ko0k0k08gk840cos0.46.224.7.54.sslip.io/api/v1/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${e}`}}).catch(()=>{}),localStorage.removeItem("vendor_token")}a({isLoggedIn:!1,token:null,vendor:null,shop:null,loading:!1})}return{subscribe:u,login:p,register:h,logout:c,checkAuth:l}}const S=m();export{S as a};
